-- Suppress variable substitution messages
SET VERIFY OFF

-- Set output formatting for A4 landscape
SET linesize 300
SET pagesize 35

-- Set Malaysia date format
ALTER SESSION SET NLS_DATE_FORMAT = 'dd/mm/yyyy';

-- Show the options
PROMPT 
PROMPT Application Status Options:
PROMPT 1 = Applied
PROMPT 2 = Resume Submitted
PROMPT 3 = Interview scheduled
PROMPT 4 = Rejected
PROMPT 5 = Interview done
PROMPT 0 = ALL statuses
PROMPT

-- Then accept the input
ACCEPT v_status NUMBER PROMPT 'Enter your choice (0-5): '

-- Define column formatting
COL Applicant_ID FORMAT A12 HEADING "Applicant ID"
COL Name FORMAT A20 HEADING "Applicant Name"
COL OrgID FORMAT A6 HEADING "Org ID"
COL Org_Name FORMAT A30 HEADING "Organization"
COL Position FORMAT A25 HEADING "Position"
COL Application_Status FORMAT A20 HEADING "Status"
COL DateApplied FORMAT A12 HEADING "Date Applied"
COL Employment_Types FORMAT A15 HEADING "Employment Type"

-- Set title format
TTITLE LEFT 'Applicants Application Status' -
RIGHT 'Page No: ' FORMAT 999 SQL.PNO SKIP 2

-- Query to check applicants and their application status with organizations
SELECT 
    ap.Applicant_ID,
    app.Name,
    ap.OrgID,
    o.Org_Name,
    jp.Position,
    ap.Application_Status,
    TO_CHAR(ap.DateApplied, 'dd/mm/yyyy') AS DateApplied,
    ap.Employment_Types
FROM 
    Applications ap
    INNER JOIN Applicants app ON ap.Applicant_ID = app.Applicant_ID
    INNER JOIN Organizations o ON ap.OrgID = o.OrgID
    INNER JOIN Job_Positions jp ON ap.JobPost_ID = jp.JobPost_ID
WHERE 
    (&v_status = 0 AND ap.Application_Status IN ('Applied', 'Resume Submitted', 'Interview scheduled', 'Rejected', 'Interview done'))
    OR (&v_status = 1 AND ap.Application_Status = 'Applied')
    OR (&v_status = 2 AND ap.Application_Status = 'Resume Submitted')
    OR (&v_status = 3 AND ap.Application_Status = 'Interview scheduled')
    OR (&v_status = 4 AND ap.Application_Status = 'Rejected')
    OR (&v_status = 5 AND ap.Application_Status = 'Interview done')
ORDER BY 
    ap.Application_Status,
    o.Org_Name,
    app.Name;

-- Reset settings at end of script
CLEAR BREAKS
CLEAR COMPUTES
CLEAR COLUMNS
TTITLE OFF
