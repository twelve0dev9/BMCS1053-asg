-- Set output formatting for A4 landscape
SET linesize 300
SET pagesize 35

-- Set Malaysia date format
ALTER SESSION SET NLS_DATE_FORMAT = 'dd/mm/yyyy';

-- Accept status filter prompt
ACCEPT v_status CHAR PROMPT 'Enter status (Applied, Resume Submitted, Interview scheduled, Rejected, Interview done, or ALL): '

-- Define column formatting
COL Applicant_ID FORMAT A8 HEADING "Applicant ID"
COL Name FORMAT A20 HEADING "Applicant Name"
COL OrgID FORMAT A6 HEADING "Org ID"
COL Org_Name FORMAT A30 HEADING "Organization"
COL Position FORMAT A25 HEADING "Position"
COL Application_Status FORMAT A20 HEADING "Status"
COL DateApplied FORMAT A12 HEADING "Date Applied"
COL Employment_Types FORMAT A15 HEADING "Employment Type"

-- Set title format with dynamic status
TTITLE LEFT 'Applicants Application Status: &v_status' -
RIGHT 'Page No: ' FORMAT 999 SQL.PNO SKIP 2

-- Query to check applicants and their application status with organizations
SELECT 
    ap.Applicant_ID,
    app.Name,
    ap.OrgID,
    o.Org_Name,
    jp.Position,
    ap.Application_Status,
    TO_CHAR(ap.DateApplied, 'dd/mm/yyyy') AS DateApplied,
    ap.Employment_Types
FROM 
    Applications ap
    INNER JOIN Applicants app ON ap.Applicant_ID = app.Applicant_ID
    INNER JOIN Organizations o ON ap.OrgID = o.OrgID
    INNER JOIN Job_Positions jp ON ap.JobPost_ID = jp.JobPost_ID
WHERE 
    (UPPER('&v_status') = 'ALL' AND ap.Application_Status IN ('Applied', 'Resume Submitted', 'Interview scheduled', 'Rejected', 'Interview done'))
    OR ap.Application_Status = '&v_status'
ORDER BY 
    ap.Application_Status,
    o.Org_Name,
    app.Name;