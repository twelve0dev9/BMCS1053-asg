-- Suppress variable substitution messages
SET VERIFY OFF

-- Set output formatting for A4 landscape
SET linesize 300
SET pagesize 35

-- Set Malaysia date format
ALTER SESSION SET NLS_DATE_FORMAT = 'dd/mm/yyyy';

-- Accept role filter prompt
ACCEPT v_role CHAR PROMPT 'Enter role (1=Sponsor, 2=Exhibitor, 3=Speech, 4=Consultancy, 0=ALL): '

-- Define column formatting
COL OrgID FORMAT A6 HEADING "Org ID"
COL Org_Name FORMAT A30 HEADING "Organization Name"
COL Email FORMAT A30 HEADING "Email"
COL Contact_Number FORMAT A15 HEADING "Contact No"
COL Industry FORMAT A20 HEADING "Industry"
COL Roles FORMAT A25 HEADING "Role"
COL nTickets FORMAT 999 HEADING "Tickets"

-- Simple title
TTITLE LEFT 'Organizations by Role' -
RIGHT 'Page No: ' FORMAT 999 SQL.PNO

-- Clear previous breaks and computes
CLEAR BREAKS
CLEAR COMPUTES

-- Set break first
BREAK ON REPORT

-- Main query to list organizations by role
SELECT 
    o.OrgID,
    o.Org_Name,
    o.Email,
    o.Contact_Number,
    i.Title AS Industry,
    o.Roles,
    o.nTickets
FROM 
    Organizations o
    INNER JOIN Industries i ON o.Industry_ID = i.Industry_ID
WHERE 
    (&v_role = 0 AND o.Roles IN ('Sponsor', 'Exhibitor', 'Speech provider', 'Consultancy provider'))
    OR (&v_role = 1 AND o.Roles = 'Sponsor')
    OR (&v_role = 2 AND o.Roles = 'Exhibitor')
    OR (&v_role = 3 AND o.Roles = 'Speech provider')
    OR (&v_role = 4 AND o.Roles = 'Consultancy provider')
ORDER BY 
    o.Roles,
    o.Org_Name;

-- Reset settings at end of script
CLEAR BREAKS
CLEAR COMPUTES
CLEAR COLUMNS
TTITLE OFF

